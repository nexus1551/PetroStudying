Настройка ssh для сервера debian/ubuntu
----

****Что такое SSH?****

****SSH - сетевой протокол для безопасного удалённого управления операционной системой и передачи данных через незащищённые сети. В общем для управления своим сервером из дома.****

----
*Алгоритм:*

1. Обновим сервер 

`apt update && apt upgrade -y`

2. Зайдем в конфиг ssh (по дефолту ssh уже стоит на сервере)
   
   `nano /etc/ssh/sshd_config`

3. Стандарт настройки которые должны стоять

   ```
   AllowUsers user1 user2          #Подставьте вместо user1;user2 ваших пользователей
   PermitRootLogin no          #Запрещает заходить на сервер с root
   MaxAuthTries 3          #Максимальное количество попыток входа
   Port 22          #Порт для входа, желательно поменять от греха подальше
   PasswordAuthentication yes          #Разрешает заход по паролям
   PermitEmptyPasswords no          #Запрещает заход с пустым паролем
   PubkeyAuthentication yes          #Разрешает заход по ключам
   AuthorizedKeysFile      .ssh/authorized_keys .ssh/authorized_keys2       #Откуда будет браться информация про ключи
   ```
4. Сохраним конфиг и запустим ssh

   `systemctl restart sshd`
   
   ``systemctl restart ssh``

----

***Полный разбор ssh и как работают ключи***

----

**Создадим пользователя на сервере для проверки**

`adduser user1`

Поставим пароль `123`

Проверим IP адресс сервера

`ip a`

70.80.81.82

*Запомните и запишите этот IP, он понадобиться в будущем*

----

***Проверка подключения к серверу по паролю***

----

*На Windows:*

Заходим в cmd и вводим `ssh user1@IP_address -p22` #Вместо IP_address вставьте IP сервера; #Вместо -p поставьте ваш номер порта который вы указали ранее

`ssh user1@70.80.81.82`

Вводим `yes`

После у вас потребует пароль, вводим пароль который ставили `123`

**Вуаля! Вы на сервере**

----

***Проверка подключения к серверу по ключам***

----

`#`Принцип работы почитайте в интернете, это трудно обьяснить

*На Windows:*

Заходим в `cmd` и пишем `ssh-keygen` и после вводим нажимаем `Enter`

У вас в `C:/Пользователи/Ваш_пользователь/.ssh` создалась папка, туда заходим и открываем файл `id_ed25519.pub` ИМЕННО PUB! Второй файл можно даже не трогать, он вам не нужен будет

Заходим на сервер по первому методу и на пользователе `user1` вводим `ssh-keygen` и нажимем Enter;

У вас создалась папка невидимая, чтобы её открыть введите `cd .ssh` и после `ls` чтобы увидеть все файлы

В этой папке вам надо создать файл `nano authorized_keys`  и скопировать то что у вас было в файлике `id_ed25519.pub` на Windows

Потом просто перезугружаем ssh и мы спокойно можем заходить без пароля

`systemctl restart ssh`

`systemctl restart sshd`

